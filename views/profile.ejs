<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header>
    <div class="container">
      <h1 class="logo">Фанаты и точка</h1>
      <nav>
        <ul>
          <li><a href="/">Главная</a></li>
          <li><a href="/explore">Изучить</a></li>
          <li><a href="/messages">Мессенджер</a></li>
          <% if (!currentUser) { %>
            <li><a href="/login">Войти</a></li>
            <li><a href="/register">Регистрация</a></li>
          <% } else { %>
            <li><a href="/profile/<%= currentUser.Id %>">Профиль</a></li>
            <li><a href="/logout">Выйти</a></li>
          <% } %>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="profile">
        
        <h2>Профиль пользователя</h2>
        <div class="profile-container">
          <div class="profile-info">
            <img src="<%= profileUser.profilePicture ? '/uploads/' + profileUser.profilePicture.split('/').pop() : '/uploads/default-avatar.png' %>" alt="User Avatar" class="profile-avatar">

            <h3><%= profileUser.profileName || 'Имя пользователя отсутствует' %></h3>
            <p><%= profileUser.Description || 'Описание отсутствует' %></p>
            <% if (user && user._id === profileUser._id) { %>
  <button class="edit-profile" onclick="toggleEditForm()">Редактировать профиль</button>
  <div id="editProfileForm" style="display:none;">
    <form action="/profile/edit" method="POST" enctype="multipart/form-data">
      <label for="profileName">Имя пользователя:</label>
      <input type="text" id="profileName" name="profileName" value="<%= profileUser.profileName %>" required>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" value="<%= profileUser.email %>" required>
      <label for="description">Описание:</label>
      <textarea id="description" name="description"><%= profileUser.Description || 'Не указано' %></textarea>
      <label for="profilePicture">Фотография профиля:</label>
      <input type="file" id="profilePicture" name="profilePicture">
      <button type="submit">Сохранить изменения</button>   
      
    </form>
                
                <form action="/delete-account" method="POST" onsubmit="return confirm('Вы уверены, что хотите удалить свой аккаунт?');">
                  <button type="submit">Удалить аккаунт</button>
                </form>
              </div>
            <% } %>
          </div>
          
          <% if (user && user._id === profileUser._id) { %>
            <div class="upload-container">
              <h2>Загрузить контент</h2>
              <form class="upload-form" action="/upload" method="POST" enctype="multipart/form-data">
                <label for="caption">Подпись:</label>
                <input type="text" name="caption" id="caption" required>
                
                <label for="media">Выберите файл:</label>
                <input type="file" name="media" id="media" accept="image/*,video/*" required>
                
                <button type="submit">Загрузить</button>
              </form>
            </div>
          <% } %>
        </div>
        
        <section class="user-posts">
          <h3>Посты пользователя</h3>
          <div class="posts-container">
            <% posts.forEach(post => { %>
              <div class="post">
                <h4><%= post.caption || 'Без подписи' %></h4>
                <% if (post.mediaType === 'photo') { %>
                  <img src="<%= post.mediaPath %>" alt="User Post" class="user-media">
                <% } else if (post.mediaType === 'video') { %>
                  <video controls class="user-media">
                    <source src="<%= post.mediaPath %>" type="video/mp4">
                    Ваш браузер не поддерживает видео.
                  </video>
                <% } %>
                <% if (currentUser && currentUser.Id === profileUser.Id) { %>
                  <form action="/post/delete/<%= post.id %>" method="POST" onsubmit="return confirm('Вы уверены, что хотите удалить этот пост?');">
                    <button type="submit" class="delete-button">Удалить пост</button>
                  </form>
                <% } %>
              </div>
            <% }) %>
          </div>
        </section>
      </section>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2024 Фанаты и точка. Все права защищены.</p>
    </div>
  </footer>

  <script>
    function toggleEditForm() {
      var form = document.getElementById('editProfileForm');
      form.style.display = (form.style.display === 'none' || form.style.display === '') ? 'block' : 'none';
    }
  </script>
</body>
</html>
